import{_ as A,r,u as H,s as O,a as R,x as $,b as E,c as F,d as b,g as n,j as g,C as Y,k as m,o as z,f as G,q as J,D as T}from"./index-CxIGT_a7.js";import{a as K,b as Q,s as W}from"./index-BRyAIBL-.js";function X(h,V=!1){if(h){var o=new Date(h),f=o.getFullYear(),d=o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1,u=o.getDate()<10?"0"+o.getDate():o.getDate(),v=o.getHours()<10?"0"+o.getHours():o.getHours(),i=o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes(),c=o.getSeconds()<10?"0"+o.getSeconds():o.getSeconds();return V?f+"-"+d+"-"+u:f+"-"+d+"-"+u+" "+v+":"+i+":"+c}else return""}const Z={class:"g-content"},j={class:"footer-btn-box"},ee={__name:"add",setup(h){const V=J(),o=r(""),f=[],d=r([]),u=r(!1);r([]),r(!1),r(!1);const v=r(""),i=r(!1),c=r(!1),k=r(new Date),y=H(),{storeUser:p}=O(y),_=R(()=>p.value.id),s=$({clientName:p.value.name,reportPhone:p.value.curPhone,deviceNo:"",deviceName:"",deviceModel:"",phone:null,elderId:_.value,customerType:null,reportAddress:null,description:null,visitTime:null,source:"用户",recordPerson:p.value.curName,createBy:p.value.curName,createById:p.value.curUserId}),C=()=>{u.value=!0},N=l=>{if(o.value=l.selectedOptions[0].text,u.value=!1,l.selectedValues<0)return;let e=l.selectedValues[0];f.value.map(a=>{a.id==e&&(s.deviceName=a.deviceName,s.deviceModel=a.deviceModel,s.deviceNo=a.sn)})},M=()=>{i.value=!0},x=l=>{v.value=l.selectedOptions[0].text,s.troubleType=l.selectedOptions[0].value,i.value=!1},U=()=>{c.value=!0},L=l=>{s.visitTime=l.selectedValues[0]+"-"+l.selectedValues[1]+"-"+l.selectedValues[2],c.value=!1},B=()=>{if(!o.value){T("请选择设备");return}if(!v.value){T("请选择故障类型");return}console.log(s,s.value,0xa1b01d4b1c7),W({...s,reportTime:X(new Date)}).then(l=>{T("操作成功"),V.push("/repair")}).catch(l=>{T(l.msg)})},S=()=>{K({elderId:_.value}).then(l=>{console.log("🚀 ~ fetchDeviceList ~ res:",l),f.value=l.data??[];let e=[];l.data.forEach(a=>{e.push({text:a.deviceName,value:a.id})}),e.unshift({text:"无设备",value:-1}),console.log("🚀 ~ fetchDeviceList ~ arr:",e),d.value=e,console.log("🚀 ~ fetchDeviceList ~ deviceTypeList:",d.value)})};return E(()=>{S()}),(l,e)=>{const a=m("van-field"),I=m("van-cell-group"),q=m("van-form"),D=m("van-picker"),w=m("van-popup"),P=m("van-date-picker");return z(),F("div",Z,[b("div",null,[n(q,{ref:"submitForm","input-align":"right","error-message-align":"right"},{default:g(()=>[n(I,{title:"基础信息",class:"marginBottom10"},{default:g(()=>[n(a,{readonly:"",required:"",name:"deviceNo",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),label:"选择设备",placeholder:"","right-icon":"arrow",onClick:C,rules:[{required:!0,message:"请选择设备"}]},null,8,["modelValue"]),n(a,{readonly:"",required:"",clickable:"",modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),label:"故障类型",placeholder:"",onClick:M,"right-icon":"arrow",rules:[{required:!0,message:"请选择故障类型"}]},null,8,["modelValue"]),n(a,{modelValue:s.reportAddress,"onUpdate:modelValue":e[2]||(e[2]=t=>s.reportAddress=t),label:"报障地址",placeholder:"请输入"},null,8,["modelValue"]),n(a,{modelValue:s.description,"onUpdate:modelValue":e[3]||(e[3]=t=>s.description=t),label:"故障描述",placeholder:"请输入"},null,8,["modelValue"]),n(a,{readonly:"",name:"datetimePicker",modelValue:s.visitTime,"onUpdate:modelValue":e[4]||(e[4]=t=>s.visitTime=t),label:"计划上门时间",placeholder:"",onClick:U,"right-icon":"arrow"},null,8,["modelValue"])]),_:1})]),_:1},512),n(w,{show:u.value,"onUpdate:show":e[6]||(e[6]=t=>u.value=t),position:"bottom"},{default:g(()=>[n(D,{"show-toolbar":"",columns:d.value,onConfirm:N,onCancel:e[5]||(e[5]=t=>u.value=!1)},null,8,["columns"])]),_:1},8,["show"]),n(w,{show:i.value,"onUpdate:show":e[8]||(e[8]=t=>i.value=t),position:"bottom"},{default:g(()=>[n(D,{"show-toolbar":"",columns:G(Q),onConfirm:x,onCancel:e[7]||(e[7]=t=>i.value=!1)},null,8,["columns"])]),_:1},8,["show"]),n(w,{show:c.value,"onUpdate:show":e[10]||(e[10]=t=>c.value=t),position:"bottom"},{default:g(()=>[n(P,{value:s.visitTime,type:"day","min-date":k.value,onConfirm:L,onCancel:e[9]||(e[9]=t=>c.value=!1)},null,8,["value","min-date"])]),_:1},8,["show"])]),b("div",j,[b("div",{class:"add-btn",onClick:Y(B,["stop"])},"确定")])])}}},te=A(ee,[["__scopeId","data-v-0cc294c1"]]);export{te as default};
