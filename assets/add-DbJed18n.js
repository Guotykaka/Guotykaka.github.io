import{_ as A,r,u as H,s as O,b as R,x as $,d as E,c as F,e as _,h as n,k as g,B as Y,l as m,o as z,g as G,v as J,C as T}from"./index-MRy_5klY.js";import{a as K,b as Q,s as W}from"./index-CiYTJyss.js";function X(V,w=!1){if(V){var o=new Date(V),f=o.getFullYear(),d=o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1,u=o.getDate()<10?"0"+o.getDate():o.getDate(),v=o.getHours()<10?"0"+o.getHours():o.getHours(),i=o.getMinutes()<10?"0"+o.getMinutes():o.getMinutes(),c=o.getSeconds()<10?"0"+o.getSeconds():o.getSeconds();return w?f+"-"+d+"-"+u:f+"-"+d+"-"+u+" "+v+":"+i+":"+c}else return""}const Z={class:"g-content"},j={class:"footer-btn-box"},ee={__name:"add",setup(V){const w=J(),o=r(""),f=[],d=r([]),u=r(!1);r([]),r(!1),r(!1);const v=r(""),i=r(!1),c=r(!1),y=r(new Date),C=H(),{storeUser:p}=O(C),D=R(()=>p.value.id),s=$({clientName:p.value.name,reportPhone:p.value.curPhone,deviceNo:"",deviceName:"",deviceModel:"",phone:null,elderId:D.value,customerType:null,reportAddress:null,description:null,visitTime:null,source:"用户",recordPerson:p.value.curName,createBy:p.value.curName,createById:p.value.curUserId}),N=()=>{u.value=!0},M=l=>{if(o.value=l.selectedOptions[0].text,u.value=!1,l.selectedValues<0)return;let e=l.selectedValues[0];f.value.map(a=>{a.id==e&&(s.deviceName=a.deviceName,s.deviceModel=a.deviceModel,s.deviceNo=a.sn)})},x=()=>{i.value=!0},U=l=>{v.value=l.selectedOptions[0].text,s.troubleType=l.selectedOptions[0].value,i.value=!1},B=()=>{c.value=!0},L=l=>{s.visitTime=l.selectedValues[0]+"-"+l.selectedValues[1]+"-"+l.selectedValues[2],c.value=!1},S=()=>{if(!o.value){T("请选择设备");return}if(!v.value){T("请选择故障类型");return}console.log(s,s.value,0xa1b01d4b1c7),W({...s,reportTime:X(new Date)}).then(l=>{T("操作成功"),w.push("/repair")}).catch(l=>{T(l.msg)})},I=()=>{K({elderId:D.value}).then(l=>{var a;console.log("🚀 ~ fetchDeviceList ~ res:",l),f.value=(a=l.data)!=null?a:[];let e=[];l.data.forEach(h=>{e.push({text:h.deviceName,value:h.id})}),e.unshift({text:"无设备",value:-1}),console.log("🚀 ~ fetchDeviceList ~ arr:",e),d.value=e,console.log("🚀 ~ fetchDeviceList ~ deviceTypeList:",d.value)})};return E(()=>{I()}),(l,e)=>{const a=m("van-field"),h=m("van-cell-group"),P=m("van-form"),k=m("van-picker"),b=m("van-popup"),q=m("van-date-picker");return z(),F("div",Z,[_("div",null,[n(P,{ref:"submitForm","input-align":"right","error-message-align":"right"},{default:g(()=>[n(h,{title:"基础信息",class:"marginBottom10"},{default:g(()=>[n(a,{readonly:"",required:"",name:"deviceNo",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value=t),label:"选择设备",placeholder:"","right-icon":"arrow",onClick:N,rules:[{required:!0,message:"请选择设备"}]},null,8,["modelValue"]),n(a,{readonly:"",required:"",clickable:"",modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value=t),label:"故障类型",placeholder:"",onClick:x,"right-icon":"arrow",rules:[{required:!0,message:"请选择故障类型"}]},null,8,["modelValue"]),n(a,{modelValue:s.reportAddress,"onUpdate:modelValue":e[2]||(e[2]=t=>s.reportAddress=t),label:"报障地址",placeholder:"请输入"},null,8,["modelValue"]),n(a,{modelValue:s.description,"onUpdate:modelValue":e[3]||(e[3]=t=>s.description=t),label:"故障描述",placeholder:"请输入"},null,8,["modelValue"]),n(a,{readonly:"",name:"datetimePicker",modelValue:s.visitTime,"onUpdate:modelValue":e[4]||(e[4]=t=>s.visitTime=t),label:"计划上门时间",placeholder:"",onClick:B,"right-icon":"arrow"},null,8,["modelValue"])]),_:1})]),_:1},512),n(b,{show:u.value,"onUpdate:show":e[6]||(e[6]=t=>u.value=t),position:"bottom"},{default:g(()=>[n(k,{"show-toolbar":"",columns:d.value,onConfirm:M,onCancel:e[5]||(e[5]=t=>u.value=!1)},null,8,["columns"])]),_:1},8,["show"]),n(b,{show:i.value,"onUpdate:show":e[8]||(e[8]=t=>i.value=t),position:"bottom"},{default:g(()=>[n(k,{"show-toolbar":"",columns:G(Q),onConfirm:U,onCancel:e[7]||(e[7]=t=>i.value=!1)},null,8,["columns"])]),_:1},8,["show"]),n(b,{show:c.value,"onUpdate:show":e[10]||(e[10]=t=>c.value=t),position:"bottom"},{default:g(()=>[n(q,{value:s.visitTime,type:"day","min-date":y.value,onConfirm:L,onCancel:e[9]||(e[9]=t=>c.value=!1)},null,8,["value","min-date"])]),_:1},8,["show"])]),_("div",j,[_("div",{class:"add-btn",onClick:Y(S,["stop"])},"确定")])])}}},te=A(ee,[["__scopeId","data-v-0cc294c1"]]);export{te as default};
